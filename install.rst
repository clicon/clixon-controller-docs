.. _controller_install:
.. sectnum::
   :start: 2
   :depth: 3

************
Installation
************

Packages
========
Some packages are required. The following are example of debian-based packages::
  
  sudo apt install flex bison git make gcc libnghttp2-dev libssl-dev
  
Source
======
Check out the following GIT repos:

- `<https://github.com/clicon/cligen.git/>`_
- `<https://github.com/clicon/clixon.git/>`_
- `<https://github.com/clicon/clixon-controller.git/>`_
- `<https://github.com/clicon/clixon-pyapi.git/>`_

Building
========
The source is built as follows.

Cligen
------
::

  cd cligen
  ./configure
  make
  sudo make install

Clixon
------
::
   
  cd clixon
  ./configure
  make
  sudo make install

Python API
----------

Either use PIP or Debian packages.

PIP:

::

  cd clixon-pyapi
  sudo -u clicon pip3 install -r requirements.txt
  sudo python3 setup.py install


Debian:

::

  cd clixon-pyapi
  sudo ./requirements-apt.sh
  sudo python3 setup.py install

Controller
----------
::
   
  cd clixon-controller
  ./configure
  make
  sudo make install

To make the controller the default clixon application::

  (cd /usr/local/etc/clixon; ln -s /usr/local/etc/clixon/controller.xml clixon.xml)

It is recommended to NOT run the controller as root.

SystemD
-------

In the clixon-controller source folder there is a file named clixon_controller.service which can be used to run the Controller backend using SystemD.

To install the SystemD service:

::

   cp clixon_controller.service /etc/systemd/system/
   sudo systemctl daemon-reload
   sudo systemctl enable clixon_controller.service
   sudo systemctl start clixon_controller.service
   sudo systemctl status clixon_controller.service

Configure options
=================
The Controller `configure` script (generated by autoconf) includes several options apart from the standard ones.

These include (standard options are omitted)
  --enable-debug              Build with debug symbols, default: no
  --with-cligen=dir           Use CLIGEN here
  --with-clixon=dir           Use Clixon here
  --with-clicon-user=user     Run as this user in example and test
  --with-clicon-group=group   Run as this group in example and test

Python install
==============
Install the python code by copy::

  sudo cp clixon_server.py /usr/local/bin/

Add a new clicon user and install the needed Python packages,
the backend will start the Python server and drop the privileges
to this user::

  sudo useradd -g clicon -m clicon

Devices
=======
The controller needs to be able to connect to devices via a NETCONF SSH sub-system.

.. note::
          Devices must be reachable from the controller via a NETCONF SSH subsystem

Setting up he SSH subsystem is different for different device vendors.

When done, you can verify reachability as follows. Example: You login and start the controller as user `ctrl`, the device user is `admin` and the IP address is `172.17.0.3`.

Verify the SSH subsystem works as follows::

  ctrl> ssh admin@172.17.0.3 -s netconf
  <?xml version="1.0" encoding="UTF-8"?>
  <hello>....</hello>]]>]]>
